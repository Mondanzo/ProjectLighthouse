@using LBPUnion.ProjectLighthouse.Configuration
@using LBPUnion.ProjectLighthouse.Extensions
@using LBPUnion.ProjectLighthouse.Helpers
@using LBPUnion.ProjectLighthouse.Localization.StringLists
@using LBPUnion.ProjectLighthouse.Types
@model LBPUnion.ProjectLighthouse.Servers.Website.Pages.Layouts.BaseLayout

@{
    if (Model!.User == null)
    {
        Model.NavigationItemsRight.Add(new PageNavigationItem(BaseLayoutStrings.HeaderLoginRegister, "/login", "sign in"));
    }
    else
    {
        if (ServerConfiguration.Instance.Authentication.UseExternalAuth)
        {
            Model.NavigationItems.Add(new PageNavigationItem(BaseLayoutStrings.HeaderAuthentication, "/authentication", "key"));
        }
        Model.NavigationItemsRight.Add(new PageNavigationItem(BaseLayoutStrings.HeaderProfile, "/user/" + Model.User.UserId, "user alternate"));

        @if (Model.User.IsAdmin)
        {
            Model.NavigationItemsRight.Add(new PageNavigationItem(BaseLayoutStrings.HeaderAdminPanel, "/admin", "cogs"));
        }
        Model.NavigationItemsRight.Add(new PageNavigationItem(BaseLayoutStrings.HeaderLogout, "/logout", "user alternate slash")); // should always be last
    }

    Model.IsMobile = Model.Request.IsMobile();

    string title;
    if (Model.Title == string.Empty)
    {
        title = ServerConfiguration.Instance.Customization.ServerName;
    }
    else
    {
        title = $"{Model.Title} - {ServerConfiguration.Instance.Customization.ServerName}";
    }
}

<!DOCTYPE html>

<html lang="en">
<head>
    <title>@title</title>
    <link rel="stylesheet" type="text/css" href="~/css/style.css">
    <link href='https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css' rel='stylesheet'>

    @* Favicon *@
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/ico" sizes="16x16,32x32,64x64,128x128" href="/favicon.ico">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#008cff">
    <meta name="msapplication-TileColor" content="#008cff">

    @* Embed Stuff *@
    <meta name="theme-color" data-react-helmet="true" content="#008cff">
    <meta content="@title" property="og:title">
    @if (!string.IsNullOrEmpty(Model.Description))
    {
        <meta content="@Model.Description" property="og:description">
    }

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    @* Google Analytics *@
    @if (ServerConfiguration.Instance.GoogleAnalytics.AnalyticsEnabled)
    {
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=@ServerConfiguration.Instance.GoogleAnalytics.Id"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', '@ServerConfiguration.Instance.GoogleAnalytics.Id');
        </script>
    }
</head>
<body>
<div class="pageContainer">
    <header class="lighthouse-header">
        <nav class="navigation">
            <input type="checkbox" hidden="true" id="menu_swap">
            <label for="menu_swap" class="mobile-only menu_icon"><i class="bx bx-md bx-menu"></i></label>
            <div class="navigations_inner">
                <div class="navigation_items">
                <a class="logo" href="/"><img src="/assets/images/Logo.png"></a>
                @foreach (PageNavigationItem navigationItem in Model!.NavigationItems)
                {
                    <a class="item" href="@navigationItem.Url">
                        @Model.Translate(navigationItem.Name)
                    </a>
                }
                </div>
                <div class="divider-solid no-margin mobile-only"></div>
                <div class="navigation_items right">
                    @foreach (PageNavigationItem navigationItem in Model!.NavigationItemsRight)
                    {
                        <a class="item" href="@navigationItem.Url">
                            @Model.Translate(navigationItem.Name)
                        </a>
                    }
                </div>
                <div class="divider-dashed no-margin mobile-only"></div>
            </div>
        </nav>
        <noscript>
            <div class="container box-container box-background error">
                <div class="divider-dashed no-margin"></div>
                <div class="box-margin">
                    <div class="icon-title">
                        <i class="bx bx-error bx-sm"></i>
                        <h2 class="no-margin">JavaScript not enabled</h2>
                    </div>
                    <p>
                        While we intend to have as little JavaScript as possible, we can not
                        guarantee everything will work without it. We recommend that you whitelist JavaScript for lbpfor.me.
                        It's not <i>too</i> bloated, we promise.
                    </p>
                </div>
                <div class="divider-dashed no-margin"></div>
            </div>
        </noscript>
        @* ReSharper disable HeuristicUnreachableCode *@
        @* ReSharper disable CSharpWarnings::CS0162 *@
        @if (!ServerStatics.IsDebug && VersionHelper.IsDirty)
        {
            <div class="container box-container box-background warning">
                <div class="divider-dashed no-margin"></div>
                <div class="box-margin">
                    <i class="warning icon"></i>
                    <span style="font-size: 1.2rem;">@Model.Translate(BaseLayoutStrings.LicenseWarnTitle)</span>
                    <p>
                        @Html.Raw(Model.Translate(BaseLayoutStrings.LicenseWarn1, 
                            "<a href=\"https://github.com/LBPUnion/project-lighthouse/blob/main/LICENSE\">GNU Affero General Public License v3.0</a>"))
                    </p>
                    <p>
                        @Html.Raw(Model.Translate(BaseLayoutStrings.LicenseWarn2, 
                            "<code>git status</code>", "<a href=\"https://github.com/LBPUnion/project-lighthouse/issues\">", "</a>"))
                    </p>
                    <p>
                        @Html.Raw(Model.Translate(BaseLayoutStrings.LicenseWarn3))
                    </p>
                </div>
                <div class="divider-dashed no-margin"></div>
            </div>
        }
        @* ReSharper restore CSharpWarnings::CS0162 *@
        @* ReSharper restore HeuristicUnreachableCode *@
    </header>
    <div class="main">
        <div class="container">
            <br>
            @if (Model.ShowTitleInPage)
            {
                <h1>@Model.Title</h1>
            }
            @RenderBody()
            <div style="height: 50px;"></div> @* makes it look nicer *@
        </div>
    </div>
    <footer>
        <div>
            <p>Page generated by @VersionHelper.FullVersion.</p>
            @if (VersionHelper.IsDirty)
            {
                <p>This page was generated using a modified version of Project Lighthouse. Please make sure you are properly disclosing the source code to any users who may be using this instance.</p>
            }
        </div>
        <button id="dark-mode-toggle" class="no-button" onclick="toggleDarkMode()">
            <i class="bx bx-md bxs-moon light-mode-only"></i>
            <i class="bx bx-md bxs-sun dark-mode-only"></i>
        </button>
        @if (ServerStatics.IsDebug)
        {
            <button type="button" class="box-margin collapsible">
                <b>Show/Hide Debug Info</b>
            </button>

            <div style="display:none" id="lighthouse-debug-info">
                <div class="divider-dashed no-margin"></div>
                <div class="box-margin">
                    <p>Model.IsMobile: @Model.IsMobile</p>
                    <p>Model.Title: @Model.Title</p>
                    <p>Model.Description: @Model.Description</p>
                    <p>Model.User.UserId: @(Model.User?.UserId.ToString() ?? "(not logged in)")</p>
                </div>
                <div class="divider-dashed no-margin"></div>
            </div>

            <script>
                const collapsible = document.getElementsByClassName("collapsible");
                
                for (let i = 0; i < collapsible.length; i++) 
                {
                  collapsible[i].addEventListener("click", function() 
                  {
                    this.classList.toggle("active");
                    const content = this.nextElementSibling;
                    if (content.style.display === "block") 
                    {
                      content.style.display = "none";
                    } 
                    else 
                    {
                      content.style.display = "block";
                    }
                  });
                }

                function toggleDarkMode(){
                    document.body.classList.toggle("dark-mode");
                    localStorage.setItem("darkMode", document.body.classList.contains("dark-mode"));
                }

                console.log(window.matchMedia('(prefers-color-scheme: dark)'));
                if (localStorage.getItem("darkMode") === null && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    console.log(window.matchMedia('prefers-color-scheme: dark').matches);
                    localStorage.setItem("darkMode", "true");
                } else {
                    localStorage.setItem("darkMode", "false");
                }

                if(localStorage.getItem("darkMode") == "true") {
                    document.body.classList.add("dark-mode");
                }
            </script>
        }
    </footer>
</div>
</body>
</html>